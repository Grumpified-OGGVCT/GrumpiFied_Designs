---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout title="GrumpiFied Designs - Custom Merchandise">
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-brand">
        <a href="/"><h1>GrumpiFied Designs</h1></a>
      </div>
      <ul class="nav-links">
        <li><a href="/">Home</a></li>
        <li class="nav-dropdown">
          <a href="#!/all" class="dropdown-toggle">Shop <span class="dropdown-arrow">▼</span></a>
          <ul class="dropdown-menu">
            <li><a href="#!/all">All Products</a></li>
            <li><a href="#!/organic+products?q=D55">Organic Products</a></li>
            <li><a href="#!/men?q=D1">Men</a></li>
            <li><a href="#!/women?q=D2">Women</a></li>
            <li><a href="#!/kids+%26+babies?q=D3">Kids & Babies</a></li>
            <li><a href="#!/accessories?q=D4">Accessories</a></li>
            <li><a href="#!/create">Customize</a></li>
          </ul>
        </li>
        <li class="nav-search">
          <form class="search-form" onsubmit="return handleSearch(event)">
            <input 
              type="search" 
              id="shop-search" 
              placeholder="Search products..." 
              class="search-input"
              aria-label="Search products"
            />
            <button type="submit" class="search-button" aria-label="Search">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16zM19 19l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </form>
        </li>
      </ul>
    </div>
  </nav>

  <section class="hero">
    <div class="hero-content">
      <h2>Welcome to GrumpiFied Designs</h2>
      <p>Premium custom merchandise with attitude. Express yourself with style.</p>
      <div class="hero-cta">
        <a href="#shop" class="cta-button">Shop Now</a>
      </div>
    </div>
  </section>

  <section id="shop" class="shop-section">
    <div class="container">
      <h2 class="section-title">Featured Products</h2>
      <p class="section-subtitle">Hand-picked designs that speak your language</p>
      <div id="myShop" class="shop-wrapper">
        <!-- Spreadshop products will be loaded here -->
        <div class="shop-loading">Loading amazing products...</div>
      </div>
      <div class="shop-actions">
        <a href="#!/all" class="view-all-btn">View All Products →</a>
      </div>
    </div>
  </section>

  <footer class="footer">
    <p>&copy; 2025 GrumpiFied Designs. All rights reserved.</p>
  </footer>

  <script is:inline>
    // Handle Spreadshop hash routing - don't hide banners, just style them
    function styleSpreadshopElements() {
      const shopContainer = document.getElementById('myShop');
      if (!shopContainer) return;

      // Style banners to match our theme instead of hiding them
      const banners = shopContainer.querySelectorAll('*');
      banners.forEach(function(el) {
        const text = el.textContent || '';
        
        // Style promotional banners to match dark theme
        if (text.includes('Order now for delivery') || 
            text.includes('Expires today') || 
            text.includes('25% off')) {
          // Keep banners visible but style them
          el.style.borderRadius = '8px';
          el.style.marginBottom = '1rem';
        }
      });

      // Hide loading text once products appear
      const loadingText = document.querySelector('.shop-loading');
      const hasProducts = shopContainer.querySelector('img[src*="product"], [class*="product"], [class*="Product"], iframe, [class*="item"]');
      if (loadingText && hasProducts) {
        loadingText.style.display = 'none';
      }
    }

    // Handle hash changes for Spreadshop routing
    function handleHashChange() {
      const hash = window.location.hash;
      if (hash && hash.startsWith('#!/')) {
        // Spreadshop is handling the route, just ensure smooth scroll
        const shopSection = document.getElementById('shop');
        if (shopSection) {
          setTimeout(() => {
            shopSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }, 100);
        }
      }
    }

    // Handle search form submission - make it global for inline handler
    window.handleSearch = function(e) {
      if (e && e.preventDefault) {
        e.preventDefault();
      }
      const searchInput = document.getElementById('shop-search');
      const query = searchInput.value.trim();
      if (query) {
        // Navigate to Spreadshop search
        window.location.hash = '#!/search?q=' + encodeURIComponent(query);
        // Scroll to shop section
        const shopSection = document.getElementById('shop');
        if (shopSection) {
          setTimeout(() => {
            shopSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }, 100);
        }
      }
      return false;
    };

    // Run after shop loads
    setTimeout(styleSpreadshopElements, 1000);
    setTimeout(styleSpreadshopElements, 3000);
    setTimeout(styleSpreadshopElements, 5000);
    
    // Listen for hash changes
    window.addEventListener('hashchange', handleHashChange);
    handleHashChange();
  </script>

  <style>
    .navbar {
      background-color: #1a1a1a;
      padding: 1rem 0;
      position: sticky;
      top: 0;
      z-index: 100;
      border-bottom: 1px solid #333;
    }

    .nav-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .nav-brand h1 {
      font-size: 1.5rem;
      font-weight: 700;
    }

    .nav-links {
      display: flex;
      list-style: none;
      gap: 2rem;
    }

    .nav-links li a {
      font-weight: 500;
      transition: opacity 0.2s;
      position: relative;
    }

    .nav-dropdown {
      position: relative;
    }

    .dropdown-toggle {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .dropdown-arrow {
      font-size: 0.7rem;
      opacity: 0.7;
      transition: transform 0.2s;
    }

    .nav-dropdown:hover .dropdown-arrow {
      transform: rotate(180deg);
    }

    .dropdown-menu {
      position: absolute;
      top: 100%;
      right: 0;
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 0.5rem 0;
      margin-top: 0.5rem;
      min-width: 200px;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s ease;
      z-index: 1000;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
    }

    .nav-dropdown:hover .dropdown-menu {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .dropdown-menu li {
      margin: 0;
    }

    .dropdown-menu a {
      display: block;
      padding: 0.75rem 1.5rem;
      transition: background 0.2s;
    }

    .dropdown-menu a:hover {
      background: #2a2a2a;
      opacity: 1 !important;
    }

    .nav-search {
      margin-left: 1rem;
    }

    .search-form {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 6px;
      padding: 0.5rem 0.75rem;
      transition: border-color 0.2s;
    }

    .search-form:focus-within {
      border-color: #4a90e2;
    }

    .search-input {
      background: transparent;
      border: none;
      color: white;
      font-size: 0.9rem;
      width: 200px;
      outline: none;
    }

    .search-input::placeholder {
      color: #888;
    }

    .search-button {
      background: transparent;
      border: none;
      color: white;
      cursor: pointer;
      padding: 0.25rem;
      display: flex;
      align-items: center;
      transition: opacity 0.2s;
    }

    .search-button:hover {
      opacity: 0.8;
    }

    @media (max-width: 768px) {
      .search-input {
        width: 150px;
      }
    }

    .hero {
      padding: 4rem 2rem;
      text-align: center;
      background: linear-gradient(135deg, #1a1a1a 0%, #111 100%);
      border-bottom: 1px solid #333;
    }

    .hero-content {
      max-width: 800px;
      margin: 0 auto;
    }

    .hero h2 {
      font-size: 3rem;
      margin-bottom: 1rem;
      font-weight: 700;
    }

    .hero p {
      font-size: 1.25rem;
      opacity: 0.9;
      margin-bottom: 2rem;
    }

    .hero-cta {
      margin-top: 2rem;
    }

    .cta-button {
      display: inline-block;
      padding: 1rem 2.5rem;
      background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
      color: white !important;
      border-radius: 6px;
      font-weight: 600;
      font-size: 1.1rem;
      transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3);
      text-decoration: none;
    }

    .cta-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(74, 144, 226, 0.4);
      opacity: 1 !important;
    }

    .shop-actions {
      text-align: center;
      margin-top: 2rem;
    }

    .view-all-btn {
      display: inline-block;
      padding: 0.875rem 2rem;
      background: transparent;
      border: 2px solid #4a90e2;
      color: #4a90e2 !important;
      border-radius: 6px;
      font-weight: 600;
      transition: all 0.2s;
    }

    .view-all-btn:hover {
      background: #4a90e2;
      color: white !important;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3);
      opacity: 1 !important;
    }

    .shop-section {
      padding: 4rem 2rem;
      min-height: 600px;
    }

    .section-subtitle {
      text-align: center;
      font-size: 1.1rem;
      opacity: 0.8;
      margin-bottom: 3rem;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .section-title {
      font-size: 2.5rem;
      margin-bottom: 2rem;
      text-align: center;
      font-weight: 700;
    }

    .shop-wrapper {
      position: relative;
      min-height: 600px;
    }

    #myShop {
      min-height: 600px;
      background: transparent;
      border-radius: 0;
      padding: 0;
    }

    .shop-loading {
      text-align: center;
      padding: 3rem;
      opacity: 0.6;
      font-size: 1.1rem;
    }

    /* Don't hide everything - be more selective */
    /* Only hide if it's clearly a banner with red background */
    #myShop div[style*="rgb(255, 0, 0)"],
    #myShop div[style*="rgb(220, 53, 69)"],
    #myShop div[style*="#dc3545"],
    #myShop div[style*="#ff0000"] {
      display: none !important;
    }

    /* Custom product card styling */
    #myShop [class*="product-card"],
    #myShop [class*="ProductCard"],
    #myShop [class*="item"],
    #myShop [class*="Item"] {
      background: #1a1a1a !important;
      border: 1px solid #333 !important;
      border-radius: 12px !important;
      overflow: hidden !important;
      transition: all 0.3s ease !important;
    }

    #myShop [class*="product-card"]:hover,
    #myShop [class*="ProductCard"]:hover {
      transform: translateY(-6px) !important;
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.4) !important;
      border-color: #4a90e2 !important;
    }

    /* Hide loading text once shop loads */
    #myShop:not(:empty) ~ .shop-loading,
    #myShop:has(> div > div) ~ .shop-loading {
      display: none;
    }

    .footer {
      background-color: #1a1a1a;
      padding: 2rem;
      text-align: center;
      border-top: 1px solid #333;
      margin-top: 4rem;
    }

    .footer p {
      opacity: 0.7;
    }

    @media (max-width: 768px) {
      .nav-container {
        flex-direction: column;
        gap: 1rem;
      }

      .hero h2 {
        font-size: 2rem;
      }

      .hero p {
        font-size: 1rem;
      }

      .section-title {
        font-size: 1.75rem;
      }
    }
  </style>
</BaseLayout>
